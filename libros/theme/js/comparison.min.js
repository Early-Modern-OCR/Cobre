(function(a){var k=function(b,c){a.ajax({url:b,cache:true,dataType:"html",success:function(d){d=a(d.replace("svc.scale.value",c));var e=d.clone();e.hide();a("body").append(e);e.find("img.pageImage").load(function(){var f=a(this).parent();f.show();a("#"+f.attr("id")).replaceWith(f);a("#facebox div.content > *").length>1?f.find("li.contract").show():f.find("li.expand").show();j()});d.find("img.pageImage").attr("src",a.facebox.settings.loadingImage);a.facebox.reveal(d);j()}})},j=function(){for(var b=
a("#facebox div.content > *"),c=4,d=0;d<b.length;d++)c+=a(b[d]).outerWidth();a("#facebox div.content").width(c);a("#facebox").animate({left:a(window).width()/2-a("#facebox").outerWidth()/2},{duration:250,queue:false})},m=function(b){b=a("#page_"+b+":has(a):has(img)");if(b.length!=1)return false;var c=b[0],d=b.parents("div.filmstrip"),e=d.parents("div.filmstripsWrapper").find("div.filmstripWrapper div.filmstrip"),f=d.serialScroll("index",c)-d.serialScroll("current"),i=[];b=[];for(var g=0,h=0;g<e.length;g++){d=
a(e[g]);c=d.serialScroll("items")[d.serialScroll("current")+f];d=a(c).find("a");c=a(c).find("img");if(!(d.length!=1||c.length!=1)){b[h]=d.attr("href");i[h]=c;h++}}c=l(i);for(g=0;g<b.length;g++)k(b[g],c[g]);return true},n=function(b){b=a("#page_"+b+":has(a):has(img)");if(b.length!=1)return false;var c=[b.find("img")];c=l(c);k(b.find("a").attr("href"),c[0]);return true},l=function(b){var c=0,d=0,e=0,f=b.length,i=a(window).width()-100,g=a(window).height()-300,h=[];for(e=0;e<f;e++){c+=b[e].width();if(b[e].height()>
d)d=b[e].height()}if(d/c>=g/i)for(e=0;e<f;e++)h[e]="0,"+g;else for(e=0;e<f;e++)h[e]=Math.floor(b[e].width()*i/c)+",0";return h};a(document).ready(function(){a(".pages").filmstrip();a.facebox.settings.opacity=0.75;a(document).bind("close.facebox",function(){a("#facebox div.content").css("width","auto")});a(".pages li > a").click(function(b){b.preventDefault();var c=a(this);b=c.parent().attr("id").replace("page_","");c=c.parents("div.filmstrip");a.facebox.loading();(c.filmstrip("data").locked?m(b):
n(b))||a.facebox.close()});a("#facebox a.expand").live("click",function(){a.facebox.loading();a("#facebox div.content").css("width","auto");m(a(this).parents("div.pageImage").attr("id").replace("pageImage_",""))});a("#facebox a.contract").live("click",function(){a.facebox.loading();a("#facebox div.content").css("width","auto");n(a(this).parents("div.pageImage").attr("id").replace("pageImage_",""))})})})(jQuery);
